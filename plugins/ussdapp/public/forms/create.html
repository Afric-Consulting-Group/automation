<style>
    .~PATH~ .logo {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
    }
    .~PATH~ .form-help {
        background: #E3F2FD;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 20px;
        font-size: 13px;
    }
    .~PATH~ .ui-dark .form-help {
        background: #1E3A5F;
    }
</style>

<ui-component name="form" path="common.form" config="if:ussdappdata;width:900;reload:?/reload;submit:?/submit" plugin="~PATH~" class="hidden ~PATH~">
    <div class="padding">
        <div class="form-help">
            <i class="ti ti-info-circle blue"></i>
            <strong>@(Deploy a new USSD Operator)</strong><br>
            @(Enter the instance name, port number (8000-9000), and USSD code to deploy a new Docker container.)
        </div>

        <div class="grid-3">
            <div class="padding">
                <ui-component name="input" path="?.name" config="placeholder:@(e.g. mtn, orange, moov);required:true;innerlabel:1;pattern:[a-z0-9\-_]+">
                    <i class="ti ti-tag"></i> @(Instance Name)
                </ui-component>
                <small>@(Use lowercase a-z, 0-9, -, _)</small>
            </div>

            <div class="padding">
                <ui-component name="input" path="?.port" config="placeholder:@(e.g. 8001);required:true;innerlabel:1;type:number;min:8000;max:9000">
                    <i class="ti ti-plug"></i> @(Port Number)
                </ui-component>
                <small>@(Port range: 8000-9000)</small>
            </div>

            <div class="padding">
                <ui-component name="input" path="?.ussdCode" config="placeholder:@(e.g. *150#);innerlabel:1">
                    <i class="ti ti-hash"></i> @(USSD Code)
                </ui-component>
                <small>@(Optional, default: *000#)</small>
            </div>
        </div>

        <div class="padding">
            <ui-component name="input" path="?.description" config="placeholder:@(Optional description);innerlabel:1;type:textarea">
                <i class="ti ti-file-text"></i> @(Description)
            </ui-component>
        </div>
    </div>

    <nav>
        <ui-component name="validate" path="?">
            <button name="submit" disabled><i class="ti ti-rocket"></i> @(DEPLOY INSTANCE)</button>
        </ui-component>
        <button name="cancel">@(CANCEL)</button>
    </nav>
</ui-component>

<script>
PLUGIN('~PATH~', function(exports) {
    exports.reload = function (com) {
        var model = exports.model || {};
        com.reconfigure({
            title: '@(Deploy New Instance)',
            icon: 'docker'
        });

        // Valeurs par défaut
        if (!model.ussdCode) {
            exports.set('ussdCode', '*000#');
        }
    };

    exports.submit = function(hide) {
        var model = exports.model;

        // Validation supplémentaire
        if (!model.name || !/^[a-z0-9\-_]+$/.test(model.name)) {
            EXEC('-notify/warning', '@(Invalid name. Use lowercase a-z, 0-9, -, _)');
            return;
        }

        if (!model.port || model.port < 8000 || model.port > 9000) {
            EXEC('-notify/warning', '@(Port must be between 8000 and 9000)');
            return;
        }

        SETTER('loading/show');
        exports.tapi('ussdapp_deploy ERROR', model, function(response, err) {
            SETTER('loading/hide');
            if (err) {
                EXEC('-notify/warning', err);
            } else {
                hide();
                EXEC('pluginussdapp/refresh');
                EXEC('-notify/success', '@(Instance deployed successfully!)');
            }
        });

        exports.model = {};
    };
});
</script>